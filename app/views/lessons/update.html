<div class="base-layout" id="createLessonPage" noindex>
    <span go-to-my-lessons-demo active="{{!isLessonInvalid()}}"></span>
    <div class="page-content-width">
        <div class="page-content-body">
            <form ng-submit='create()' class="createLesson-form lergo-form container" name="lessonCreateForm">
                <div class="lergo-label">
                    <span class="error" ng-show='errorMessage'>{{errorMessage}}</span>
                </div>
                <div class="form-section form-group name"
                     ng-class="{ 'has-error' : lessonCreateForm.name.$invalid && !lessonCreateForm.$pristine }">
                    <div class="lergo-label">{{ 'lessons.name' | translate }}</div>
                    <div class="lergo-input">
                        <input required class="form-control" ng-model="lesson.name" name="name"/>
                    </div>
                    <p ng-show="lessonCreateForm.name.$invalid && !lessonCreateForm.$pristine" class="help-block">
                        {{'lessons.error.invalidName' | translate}}</p>
                </div>
                <div class="form-section description form-group">
                    <div class="lergo-label">{{ 'lessons.description' | translate }}</div>
                    <div class="lergo-input">
                        <textarea class="form-control" ng-model="lesson.description" name="description"></textarea>
                    </div>
                </div>
                <div class="stats form-group">
                    <div class="language">
                        <span>{{ 'filters.labels.language' | translate }}</span>
                        <select class="form-control" ng-model="lesson.language"
                                ng-options="l as ('filters.languages.' + l| translate) for l in languages"
                                name="language"></select>
                    </div>
                    <div class="subject">
                        <span>{{ 'filters.labels.subject' | translate }}</span>
                        <select class="form-control" ng-model="lesson.subject"
                                ng-options="s as ('filters.subjects.' + s | translate) for s in subjects"
                                name="subject"></select>
                    </div>
                    <div class="age">
                        <span>{{ 'fromAge' | translate }}</span>
                        <input class="form-control" type="number" min="4" max="18" step="1" size="2"
                               ng-model="lesson.age" name="age"/>
                    </div>
                </div>
                <div class="tag form-group">
                    <div class="row">
                        <span>{{ 'tags' | translate }}</span>
                        <!--<input class="form-control"  ng-model="lesson.tags" name="tag" />-->
                        <div>
                            <div tag-section tags="lesson.tags" tags-available="allAvailableTags"></div>
                        </div>
                    </div>
                </div>
                <div class="advance-options">
                    <div class="lergo-h1">
                        <br>
                        <button class="btn-link expander" ng-click="advanceOptionCollapsed = !advanceOptionCollapsed"
                                ng-show="!!lesson.name">
                            <i ng-show="!!advanceOptionCollapsed" class="fa fa-plus-square"></i>
                            <i ng-show="!advanceOptionCollapsed" class="fa fa-minus-square"></i>
                            {{ 'advancedOptions' | translate }}
                        </button>
                    </div>
                    <div collapse="advanceOptionCollapsed">
                        <hr>
                        <table class=" lergo-table lergo-form">
                            <tbody>
                            <tr>
                                <td style="width: 15%">{{ 'lessons.recommenedNextLesson' | translate }}</td>
                                <td>
                                    <input placeholder="{{'lessons.recommenedNextLessonText' | translate}}"
                                           ng-model="lesson.nextLesson"/>
                                </td>
                            </tr>
                            <tr>
                                <td>{{ 'lessons.recommenedPriorLesson' | translate }}</td>
                                <td>
                                    <input placeholder="{{'lessons.recommenedPriorLessonText' | translate}}"
                                           ng-model="lesson.priorLesson"/>
                                </td>
                            </tr>
                            <tr>
                                <td>{{ 'lessons.addCoverPage' | translate }}</td>
                                <td>
                                    <input lergo-input-converter
                                           placeholder="{{'lessons.addCoverPageHint' | translate}}"
                                           ng-model="lesson.coverPage"/>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div ng-repeat="step in lesson.steps">
                    <hr style="float: none"/>
                    <div style="float: right">
                        <a href="" ng-click="moveStepUp($index)" ng-show="!$first" class="fa fa-arrow-up"></a>
                        <a href="" ng-click="moveStepDown($index)" ng-show="!$last" class="fa fa-arrow-down"></a>
                        <a ng-click="deleteStep(step)" href="">
                            <i class="fa fa-trash-o"></i>
                        </a>
                    </div>
                    <table class="lergo-table lergo-form">
                        <tr>
                            <td style="width: 13%">{{ 'steps.title' | translate }}</td>
                            <td>
                                <input ng-model="step.title"/>
                            </td>
                        </tr>
                        <tr>
                            <td>
								<span class="pop-up-hint" style="padding: 0px;">
									<span> {{ 'steps.type' | translate }} </span>
									<span>
										<!--  tabindex = 0 is use to fix focus trigger problem in google chrome -->
										<button popover="{{'steps.typeHint' | translate}}" class="fa fa-question-circle"
                                                popover-placement="top" popover-trigger="focus" tabindex="0"></button>
									</span>
								</span>
                            </td>
                            <td>
                                <select ng-model="step.type"
                                        ng-options="t.id as ('steps.' + t.id | translate) for t in stepTypes">
                                </select>
                            </td>
                        </tr>
                    </table>
                    <div ng-include="getStepViewByType(step)"></div>
                    <div class="step-actions">
                        <button class="btn" ng-click="displayStep(step)">{{ 'steps.display' | translate }}</button>
                    </div>
                </div>
                <div save-status="saveStatus"></div>
                <div>
                </div>
                <div class="add-step-hint">

                </div>
                <div class="lesson-actions"> <!-- lesson actions -->
                    <button class="btn" ng-click="done()" ng-disabled="saveButtonDisabled()">{{'done' | translate }}
                    </button>
                    <button class="btn" ng-click="done('showLesson')" ng-disabled="saveButtonDisabled()">
                        {{'button.showLesson' | translate }}
                    </button>
                    <span class="pop-up-hint add-step-button">
						<button class="btn btn-start" ng-click="addStep(lesson)"
                                ng-disabled="saveButtonDisabled()">{{ 'steps.add' | translate }}</button>


						<span>
							<!--  tabindex = 0 is use to fix focus trigger problem in google chrome -->
							<button popover="{{'steps.addHint' | translate}}"
                                    popover-is-open="popoverState.open"
                                    popover-placement="{{popoverState.position}}" popover-trigger="focus"
                                    tabindex="0"></button>
						</span>
                    </span>

                </div>
            </form>
        </div>
        <div class="sidebar page-content-sidebar">
            <div helper-content path="'/lesson/update'" user="user"></div>
        </div>
    </div>
</div>
